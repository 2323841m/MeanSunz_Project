{% extends 'meansunz/base.html' %}
{% load staticfiles %}

{% block title_block %}
    Index
{% endblock %}

{% block head_block %}
    {# Make votes and vote buttons render in a line TODO: move to style sheet #}
    <style>
        p {
            color: white;
        }

        form {
            display: inline-block;
        }
    </style>
{% endblock %}

{% block body_block %}

    <div>
        {% if user.is_authenticated %}
            <a href="{% url 'create_post' category %}">Create Post</a>
        {% endif %}
    </div>

    <div class="postBody">
        {% if posts %}

            {% for post in posts %}
                {# DO NOT RENAME THIS CLASS add another div inside if you need to#}
                <div class="infinite-item">

                    <div>
                        <a href="{% url 'show_post' post.category.slug post.id post.slug %}">{{ post.title|truncatechars:100 }}</a>
                    </div>

                    {% if post.picture %}
                        <div>
                            {# used object tag to render video TODO: possibly use image and video tags #}
                            <object width="355" height="200" data="{{ MEDIA_URL }}{{ post.picture }}"></object>
                        </div>
                    {% endif %}

                    {# TODO: change voting to a script #}
                    <form action="{% url 'vote' post.category.slug post.id post.slug %}" method="post">
                        {% csrf_token %}
                        <button type="submit" name="upvote_post" value="upvote_post">+</button>
                        {# next points to site to be redirected back to after vote #}
                        <input type="hidden" name="next" value="{{ request.path }}">
                    </form>
                    {{ post.likes }}
                    <form action="{% url 'vote' post.category.slug post.id post.slug %}" method="post">
                        {% csrf_token %}
                        <button type="submit" name="downvote_post" value="downvote_post">-</button>
                        {# next points to site to be redirected back to after vote #}
                        <input type="hidden" name="next" value="{{ request.path }}">
                    </form>

                </div>
                <br/>
            {% endfor %}

        {% else %}
            <strong>There are no posts present.</strong>
        {% endif %}
    </div>



    {# If there are more posts to render #}
    {% if page_obj.has_next %}
        <a class="infinite-more-link" href="?page={{ page_obj.next_page_number }}">More</a>
    {% endif %}

    {# What to show while loading more posts #}
    <div class="load" style="display: none;">
        Loading...
    </div>

    {# Infinite scroll script #}
    <script>
        var infinite = new Waypoint.Infinite({
            element: $('.postBody')[0],
            onBeforePageLoad: function () {
                $('.load').show();
            },
            onAfterPageLoad: function ($items) {
                $('.load').hide();
            }
        });
    </script>


{% endblock %}