{% extends 'meansunz/base.html' %}
{% load staticfiles %}

{% block title_block %}
    Index
{% endblock %}

{% block head_block %}
    {# Make votes and vote buttons render in a line TODO: move to style sheet #}
    <style>
        p {
            color: white;
        }

        form {
            display: inline-block;
        }
    </style>
{% endblock %}

{% block body_block %}
	<div class="contentBody">
		<div style="margin-bottom:25px;">
			{% if user.is_authenticated %}
				<a class="createPost" href="{% url 'create_post' category %}">Create Post</a>
			{% endif %}
		</div>

		<div class="postBody">
			{% if posts %}

				{% for post in posts %}
					{# DO NOT RENAME THIS CLASS add another div inside if you need to#}
					<div class="infinite-item">
						<a href="{% url 'show_post' post.category.slug post.id post.slug %}">
							<div class="post">
								<div class="voteBar">
									<div class="upVote">
										<form action="{% url 'vote' post.category.slug post.id post.slug %}" method="post">
											{% csrf_token %}
											<button class="voteButton" type="submit" name="upvote_post" value="upvote_post">+</button>
											<!-- next points to site to be redirected back to after vote -->
											<input type="hidden" name="next" value="{{ request.path }}">
										</form>
									</div>
									<div class="downVote">
										<form action="{% url 'vote' post.category.slug post.id post.slug %}" method="post">
											{% csrf_token %}
											<button class="voteButton" type="submit" name="downvote_post" value="downvote_post">-</button>
											<!-- next points to site to be redirected back to after vote -->
											<input type="hidden" name="next" value="{{ request.path }}">
										</form>
									</div>
									<div>
										<h6>{{ post.likes }}</h6>
									</div>
								</div>
								<div class="postContent">
									<div>
										<h3>
											{{ post.title }}
										</h3>
									</div>

									<div>
										<h4>{{ post.user }}</h4>
									</div>

									<div class="commentsBar">
										<div>
											<h6>1233 Comments</h6>
										</div>
										<div>
											<h6>Report</h6>
										</div>
									</div>
								</div>
								<div class="postMedia">
									{% if post.picture %}
										<p><img src="{{ MEDIA_URL }}{{ post.picture }}" alt="" style="width:100%;height:100%;"></p>
									{% endif %}
								</div>
							</div>
						</a>
					</div>
				{% endfor %}
			{% else %}
				<h2 style="font-size: 30px"><strong>There are no posts present.</strong></h2>
        {% endif %}
		
		{# If there are more posts to render #}
		{% if page_obj.has_next %}
			<a class="infinite-more-link" href="?page={{ page_obj.next_page_number }}">More</a>
		{% endif %}

		{# What to show while loading more posts #}
		<div class="load" style="display: none;">
			Loading...
		</div>
	</div>

    {# Infinite scroll script #}
    <script>
        var infinite = new Waypoint.Infinite({
            element: $('.postBody')[0],
            onBeforePageLoad: function () {
                $('.load').show();
            },
            onAfterPageLoad: function ($items) {
                $('.load').hide();
            }
        });
    </script>


{% endblock %}