{% extends 'meansunz/base.html' %}
{% load staticfiles %}
{% load meansunz_template_tags %}

{% block head_block %}
{% endblock %}

{% block title_block %}
    {{ post.title }}
{% endblock %}

{% block body_block %}
    {% if post %}
        <div class="contentBody">
        <div class="post">
            <div class="voteBar">
                <div class="upVote">
                    <form action="{% url 'vote' post.category.slug post.id post.slug %}" method="post">
                        {% csrf_token %}
                        <button style="background-color: #93d1ff;" class="voteButton" type="submit" name="vote"
                                value="1">+
                        </button>
                        <!-- next points to site to be redirected back to after vote -->
                        <input type="hidden" name="next" value="{{ request.path }}">
                    </form>
                </div>
                <div class="downVote">
                    <form action="{% url 'vote' post.category.slug post.id post.slug %}" method="post">
                        {% csrf_token %}
                        <button style="background-color: #93d1ff;" class="voteButton" type="submit" name="vote" value="-1">
                            -
                        </button>
                        <!-- next points to site to be redirected back to after vote -->
                        <input type="hidden" name="next" value="{{ request.path }}">
                    </form>
                </div>
            </div>
            <div class="postContent">
                <div>
                    <h4>
                        <a href="{% url 'show_post' post.category.slug post.id post.slug %}">{{ post.title }}</a>
                    </h4>
                </div>

                <div>
                    <h4>{{ post.user }}</h4>
                </div>

                <div class="commentsBar">
                    <h6>{% get_post_votes post %} RATING</h6>
                </div>
            </div>
        </div>

        <div class="postDesc">
            {% if post.picture %}
                <div class="postMedia" style="width:200px;height:200px;">

                    <p style="margin-left: 0;"><img src="{{ MEDIA_URL }}{{ post.picture }}" alt=""
                                                    style="width:100%;height:100%;"></p>

                </div>
            {% endif %}
            <div>
                <p style="	color: #222125ff;">{{ post.description }}</p>
            </div>
        </div>

        <div class="separator"></div>

        {# New comment form #}
        {% if user.is_authenticated %}

            <div><p>Comment as {{ user.username }}</p></div>

            <form id="comment_form" method="post"
                  action="/category/{{ category.slug }}/{{ post.id }}/{{ post.slug }}/"
                  enctype="multipart/form-data">

                {% csrf_token %}
                {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                {% endfor %}
                {% for field in form.visible_fields %}
                    {{ field.errors }}
                    {{ field.help_text }}
                    {{ field }}
                {% endfor %}
                <input type="submit" name="submit" value="Comment"/>
            </form>

            <div class="separator"></div>
        {% endif %}


        {# Render Comments #}
        {% if comments %}
            {% for comment in comments %}

                <div class="post">
                    <div class="voteBar">
                        <div>
                            <form action="{% url 'vote_comment' category.slug post.id post.slug %}" method="post">

                                {% csrf_token %}

                                <button style="background-color: #93d1ff;" class="voteButton" type="submit"
                                        name="vote_comment" value="1">+
                                </button>

                                <button style="background-color: #93d1ff;" class="voteButton" type="submit"
                                        name="vote_comment" value="-1">-
                                </button>

                                {# comment id to later identify comment upvoted #}
                                <input type="hidden" name="id" value="{{ comment.id }}">
                            </form>
                        </div>
                    </div>
                    <div class="postContent">
                        <div>
                            <h4>
                                <b>{{ comment.content }}</b>
                            </h4>
                        </div>

                        <div>
                            <h4>{{ comment.user }}</h4>
                        </div>

                        <div class="commentsBar">
                            <h6>{% get_comment_votes comment %} RATING</h6>
                        </div>
                    </div>
                    <div class="postMedia">
                        {% if comment.picture %}
                            <p style="margin-left: 0;"><img src="{{ MEDIA_URL }}{{ comment.picture }}" alt=""
                                                            style="width:100%;height:100%;"></p>
                        {% endif %}
                    </div>
                </div>



            {% endfor %}
        {% endif %}

    {% else %}
        <h2>Post does not exist</h2>
    {% endif %}
</div>


{% endblock %}